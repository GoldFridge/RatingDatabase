# PostgreSQL: Масштабируемая система пользователей и рейтингов

Проект демонстрирует реализацию масштабируемой базы данных пользователей с системой друзей и рейтингами, используя **PostgreSQL**.

## Применённые подходы и оптимизации

Этот проект спроектирован с учётом производительности и масштабируемости. Ниже представлены принципы и техники, использованные в реализации:

### 1. **Оконные функции**

Используются для расчёта позиций в рейтинге (`RANK()`), как в глобальном масштабе, так и по городу. Это позволяет гибко выполнять сортировки без дополнительных подзапросов или JOIN-ов.

---

### 2. **CTE (Common Table Expressions)**

Используются для пошагового вычисления, например:

- `ranked_users` — формирование глобального и городского рейтингов
- `user_data` — изолированное получение информации об одном пользователе
- `friends_ranks` — ранжирование друзей пользователя

Это повышает читаемость и переиспользуемость логики.

---

### 3. **Индексы**

Созданы целевые индексы:

- `users(points DESC)` — ускоряет сортировки по очкам
- `users(city)` — ускоряет выборку по городу
- `friends(user_id)` / `friends(friend_id)` — оптимизируют связи друзей

Также возможно использование **частичных индексов**, если нужно выделить активных или топовых пользователей.

---

### 4. **Проверки и ограничения**

- CHECK (`points BETWEEN 0 AND 1000000`)
- CHECK (`user_id <> friend_id`)

Это позволяет избежать ошибок на уровне данных и повысить надёжность схемы.

---

### 5. **Генерация данных через `generate_series` и `DO`-блок**

Встроенные средства PostgreSQL позволяют создавать миллионы строк быстро и без внешних скриптов. Использование `random()` обеспечивает реалистичное распределение данных.

---
